<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> JSON Formatter - Beautify, Minify, Validate | tool.tl </title>
  <link rel="stylesheet" href="/static/assets/style.css">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="alternate icon" href="/static/favicon.png" type="image/png" sizes="32x32">
    <meta name="description" content="Free online JSON tool for beautifying, minifying, validating, tree view, and Unicode conversion. Supports beautify, minify, validate, tree view, and Unicode conversion.">

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/utils.js"></script>

</head>
<body>
<div class="wrap">
  <meta name="color-scheme" content="light dark">

  <main>
    <section id="main" class="panel" style="position: relative">
        <h1 class="h1">JSON Formatter Tool</h1>
        <p class="sub">Supports beautify, minify, validate, tree view, and Unicode conversion.</p>

        <div class="json-tool">
            <!-- Input panel -->
            <div class="json-panel">
                <div class="panel-header">
                    Input JSON
                    <button class="btn-clear" onclick="clearInput()" title="Clear input">ðŸ—‘</button>
                </div>
                <textarea id="json-input" placeholder="Paste your JSON hereâ€¦"></textarea>
            </div>

            <!-- Result panel -->
            <div class="json-panel">
                <div class="panel-header">
                    Result JSON
                    <button class="btn-clear" onclick="clearOutput()" title="Clear output">ðŸ—‘</button>
                </div>
                <textarea id="json-output" placeholder="Result will appear hereâ€¦" readonly></textarea>
            </div>
        </div>

        <!-- JSON action buttons -->
        <div class="json-actions">
            <div class="json-panel" style="flex-direction: row;">
                <button class="btn" onclick="formatJson()">Format</button>
                <button class="btn" onclick="minifyJson()">Minify</button>
                <button class="btn" onclick="validateJson()">Validate</button>
                <button class="btn" onclick="unescapeUnicode()" id="unicode-button">Unescape Unicode</button>
                <button class="btn" onclick="escapeUnicode()">Escape Unicode</button>
            </div>
            <div class="json-panel" style="flex-direction: row;">
                <button class="btn" onclick="copyJson()">Copy Result</button>
                <button class="btn" onclick="renderTree()">Tree View</button>
            </div>
        </div>

        <!-- Tree modal -->
        <div id="treeModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('treeModal')">Ã—</span>
                <h2>Tree View</h2>
                <div id="modal-json-tree" class="json-tree"></div>
            </div>
        </div>

    </section>

    <style>
        .json-tool {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
            margin-top: 1em;
        }

        .json-panel {
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card);
        }

        .panel-header {
            padding: 0.5em 0.8em;
            font-weight: bold;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-clear {
            font-size: 0.8em;
            padding: 2px 6px;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        .json-panel textarea {
            flex: 1;
            min-height: 500px;
            border: none;
            padding: 0.8em;
            font-family: monospace;
            font-size: 0.9em;
            resize: none;
            background: var(--card);
            color: var(--text);
        }

        .json-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
            margin-top: 1em;
        }

        .json-actions .btn {
            flex: 1;
            margin: 10px
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
        }

        .modal-content {
            background: var(--card);
            margin: 5% auto;
            padding: 1em;
            border-radius: var(--radius);
            width: 90%;
            height: 80%;
            overflow: auto;
        }

        .close {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
        }

        /* Tree styles */
        .json-tree {
            font-family: monospace;
            font-size: 0.9em;
        }

        .json-tree ul {
            list-style: none;
            padding-left: 1em;
        }

        .json-tree li {
            margin: 2px 0;
            white-space: nowrap;
        }

        .json-tree .key {
            color: var(--accent);
        }

        .json-tree .string {
            color: #16a34a;
        }

        .json-tree .number {
            color: #2563eb;
        }

        .json-tree .boolean {
            color: #d97706;
        }

        .json-tree .null {
            color: #6b7280;
        }

        .json-tree .toggle {
            cursor: pointer;
            margin-right: 4px;
        }

        .json-tree .collapsed > ul {
            display: none;
        }

        .json-tree .meta {
            color: #999;
            font-size: 0.8em;
            margin-left: 4px;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .json-tool {
                grid-template-columns: 1fr;
            }

            .json-actions {
                grid-column: span 1;
            }
        }

        /* Default button (disabled or inactive) */
        #unicode-button {
        background: #fff;
        color: #2563eb;
        border: 1px solid #2563eb;
        cursor: not-allowed;
        opacity: 0.7;
        }

        /* Active state */
        #unicode-button.active {
        background: #2563eb;
        color: #fff;
        cursor: pointer;
        opacity: 1;
        transition: all 0.2s ease;
        }

        #unicode-button.active:hover {
        box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
        }

        /* Dark mode */
        @media (prefers-color-scheme: dark) {
        #unicode-button {
            background: #101631;
            color: #3b82f6;
            border: 1px solid #30384d;
        }
        #unicode-button.active {
            background: #3b82f6;
            color: #fff;
        }
        }
    </style>

    <script>
        // Language pack (English)
        const json_formatter_txt = {
            "btn_clear": "Clear",
            "btn_copy": "Copy Result",
            "btn_escape": "Chinese â†’ Unicode",
            "btn_escape_alias": "Escape Unicode",
            "btn_format": "Format",
            "btn_minify": "Minify",
            "btn_tree": "Tree View",
            "btn_unescape": "Unicode â†’ Chinese",
            "btn_unescape_alias": "Unescape Unicode",
            "btn_validate": "Validate",
            "clear_input": "Clear input",
            "clear_input_success": "Input cleared",
            "clear_output": "Clear output",
            "clear_output_success": "Output cleared",
            "empty_content": "âš ï¸ Empty content",
            "input_placeholder": "Paste your JSON hereâ€¦",
            "json_invalid": "âŒ Invalid JSON, cannot render tree",
            "msg_cleared": "ðŸ—‘ Cleared",
            "msg_copied": "ðŸ“‹ Copied to clipboard",
            "msg_empty": "âš ï¸ Nothing to copy",
            "msg_escape": "âœ… Unicode escaped",
            "msg_invalid": "âŒ Invalid JSON: {error}",
            "msg_no_tree_to_view": "âš ï¸ No tree to view",
            "msg_unescape": "âœ… Unicode decoded",
            "msg_valid": "âœ… JSON is valid!",
            "no_content_copy": "âš ï¸ No content to copy",
            "output_placeholder": "Result will appear hereâ€¦",
            "panel_input": "Input JSON",
            "panel_output": "Result JSON",
            "panel_tree": "Tree View",
            "seo_desc": "Free online JSON tool for beautifying, minifying, validating, tree view, and Unicode conversion.",
            "seo_title": "JSON Formatter - Beautify, Minify, Validate | tool.tl",
            "subtitle": "Supports beautify, minify, validate, tree view, and Unicode conversion.",
            "title": "JSON Formatter Tool",
            "tree_update_failed": "âš ï¸ Tree update failed",
            "unicode_decoded": "âœ… Unicode decoded",
            "unicode_escaped": "âœ… Escaped to Unicode (double slashes)"
        };

        // ===== JSON Functions =====
        function formatJson() {
            const input = document.getElementById("json-input").value;
            if (!input) return showMessage(json_formatter_txt.empty_content);
            try {
                const obj = JSON.parse(input);
                document.getElementById("json-output").value = JSON.stringify(obj, null, 2);
            } catch (e) {
                showMessage("âŒ " + e.message);
            }
        }

        function minifyJson() {
            const input = document.getElementById("json-input").value;
            if (!input) return showMessage(json_formatter_txt.empty_content);
            try {
                const obj = JSON.parse(input);
                document.getElementById("json-output").value = JSON.stringify(obj);
            } catch (e) {
                showMessage("âŒ " + e.message);
            }
        }

        function validateJson() {
            const input = document.getElementById("json-input").value;
            if (!input) return showMessage(json_formatter_txt.empty_content);
            try {
                JSON.parse(input);
                showMessage(json_formatter_txt.msg_valid);
            } catch (e) {
                showMessage("âŒ " + e.message);
            }
        }

        function copyJson() {
            const output = document.getElementById("json-output");
            if (!output.value) return showMessage(json_formatter_txt.no_content_copy);
            output.select();
            document.execCommand("copy");
            showMessage(json_formatter_txt.msg_copied);
        }

        function unescapeUnicode() {
            const input = document.getElementById("json-input").value;
            if (!input) return showMessage(json_formatter_txt.empty_content);

            let obj;
            try {
                // Try strict JSON first
                obj = JSON.parse(input);
            } catch (err) {
                try {
                    // Fallback: replace \" with " and try again
                    const normalized = input.replace(/\\"/g, '"');
                    obj = JSON.parse(normalized);
                } catch (e) {
                    return showMessage("âŒ " + e.message);
                }
            }

            // Recursively decode all string values
            function decodeStr(val) {
                if (typeof val === "string") {
                    return val
                        .replace(/\\\\u([\dA-Fa-f]{4})/g, (_, g) =>
                            String.fromCharCode(parseInt(g, 16))
                        )
                        .replace(/\\u([\dA-Fa-f]{4})/g, (_, g) =>
                            String.fromCharCode(parseInt(g, 16))
                        );
                } else if (Array.isArray(val)) {
                    return val.map(decodeStr);
                } else if (val && typeof val === "object") {
                    const res = {};
                    for (const k in val) res[k] = decodeStr(val[k]);
                    return res;
                }
                return val;
            }

            const decoded = decodeStr(obj);

            document.getElementById("json-input").value = JSON.stringify(decoded, null, 2);
            showMessage(json_formatter_txt.msg_unescape);
        }

        function escapeUnicode() {
            const input = document.getElementById("json-input").value;
            if (!input) return showMessage(json_formatter_txt.empty_content);

            try {
                const obj = JSON.parse(input);

                // Recursively encode string values and keys
                function encodeStr(val) {
                    if (typeof val === "string") {
                        return val.split("").map(ch => {
                            const code = ch.charCodeAt(0);
                            return code > 127
                                ? "\\u" + code.toString(16).padStart(4, "0")
                                : ch;
                        }).join("");
                    } else if (Array.isArray(val)) {
                        return val.map(encodeStr);
                    } else if (val && typeof val === "object") {
                        const res = {};
                        for (const k in val) {
                            // Encode both key and value
                            const newKey = encodeStr(k);
                            res[newKey] = encodeStr(val[k]);
                        }
                        return res;
                    }
                    return val;
                }

                const encoded = encodeStr(obj);
            
                document.getElementById("json-input").value = JSON.stringify(encoded, null, 2);
                showMessage(json_formatter_txt.unicode_escaped);

            } catch (e) {
                showMessage("âŒ " + e.message);
            }
        }

        // ===== Clear =====
        function clearInput() {
            document.getElementById("json-input").value = "";
            showMessage(json_formatter_txt.clear_input_success);
            checkUnicodeTools();
        }

        function clearOutput() {
            document.getElementById("json-output").value = "";
            showMessage(json_formatter_txt.clear_output_success);
        }

        // ===== Tree View =====
        function renderTree() {
            const output = document.getElementById("json-output");
            if (!output.value) return showMessage(json_formatter_txt.msg_no_tree_to_view);

            let raw = output.value || document.getElementById("json-input").value;
            let obj;
            try {
                obj = JSON.parse(raw);
            } catch (e) {
                return showMessage(json_formatter_txt.json_invalid);
            }
            const target = document.getElementById("modal-json-tree");
            target.innerHTML = "";
            target.appendChild(buildTree(obj));
            openModal('treeModal');
        }

        function buildTree(obj) {
            const ul = document.createElement("ul");
            if (Array.isArray(obj)) {
                obj.forEach((val, i) => {
                    const li = document.createElement("li");
                    renderNode(li, i, val, true);
                    ul.appendChild(li);
                });
            } else {
                for (const key in obj) {
                    const li = document.createElement("li");
                    renderNode(li, key, obj[key], false);
                    ul.appendChild(li);
                }
            }
            return ul;
        }

        function renderNode(li, key, val, isArray) {
            if (typeof val === "object" && val !== null) {
                const span = document.createElement("span");
                span.className = "toggle";
                span.textContent = "â–¶";
                span.onclick = () => {
                    li.classList.toggle("collapsed");
                    span.textContent = li.classList.contains("collapsed") ? "â–¶" : "â–¼";
                };
                li.appendChild(span);
                li.innerHTML += `<span class="key">${isArray ? "[" + key + "]" : '"' + key + '"'}</span>: {<span class="meta">${Array.isArray(val) ? "Array[" + val.length + "]" : "Object"}</span>`;
                li.appendChild(buildTree(val));
                li.innerHTML += "}";
            } else {
                let typeClass = typeof val;
                if (val === null) typeClass = "null";
                li.innerHTML = `<span class="key">${isArray ? "[" + key + "]" : '"' + key + '"'}</span>: <span class="${typeClass}">${JSON.stringify(val)}</span> <span class="meta">(${typeClass})</span>`;
            }
        }

        // ===== Modal =====
        function openModal(id) {
            document.getElementById(id).style.display = "block";
        }

        function closeModal(id) {
            document.getElementById(id).style.display = "none";
        }

        // ===== Unicode button state =====
        document.getElementById("json-input").addEventListener("input", checkUnicodeTools);

        function checkUnicodeTools() {
            const val = document.getElementById("json-input").value;
            const unicodeBtn = document.getElementById("unicode-button");

            if (!val) {
                unicodeBtn.disabled = true;
                unicodeBtn.classList.remove("active");
                return;
            }

            const canProcess = /[\u4e00-\u9fa5]/.test(val) ||
                               /\\u[0-9a-fA-F]{4}/.test(val) ||
                               /\\"/.test(val) ||
                               /\\\\/.test(val);

            if (canProcess) {
                unicodeBtn.disabled = false;
                unicodeBtn.classList.add("active");
            } else {
                unicodeBtn.disabled = true;
                unicodeBtn.classList.remove("active");
            }
        }
    </script>
</main>

</div>
<div id="global-message" class="global-message"></div>

</body></html>
